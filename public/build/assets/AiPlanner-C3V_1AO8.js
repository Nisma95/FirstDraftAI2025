import{m as G,S as C,r as f,j as r,L as J}from"./app-3E3PtKXV.js";import{A as D}from"./AuthenticatedLayout-Al22e_c0.js";import{T as z}from"./TopTools-dxst2J6M.js";import K from"./ProjectSelection-CkzFC63t.js";import X from"./IntroStep-AlMVGNqO.js";import B from"./AiQuestionsStep-D63_F9gV.js";import Q from"./GeneratingStep-B9jYKMa1.js";import U from"./ErrorMessage-ao_ud1Bf.js";import{u as q}from"./useTranslation-CyUEp7kq.js";import{A as I}from"./index-CmVgNgTD.js";import{m as _}from"./proxy-BUtl0h-a.js";import"./StarBackground-DIxez7K7.js";import"./ApplicationLogo-BpWYQmhQ.js";import"./AuthIcon-FxtRzaIL.js";import"./createLucideIcon-KufGFvXY.js";import"./ProjectSelectionCard-Bkn5DnFk.js";import"./CreateNewProjectCard-DQIvFTQq.js";import"./PlusIcon-DHU16mqs.js";import"./SparklesIcon-CQeEYrAs.js";import"./QuestionsStep-BAHCsZxQ.js";import"./ProgressBar-C_pXNePe.js";import"./AIQuestionCard-jS_XV2JF.js";import"./CurrencyDollarIcon-BtNF1S8Y.js";import"./AnswerInput-DynBlaQk.js";function W(){const{t:c}=q(),{data:x,setData:j}=G({answer:""});return{data:x,setData:j,handleCreateNewProject:()=>{C.visit("/projects/create")},startAIConversation:async l=>{var m;const s=l.description||l.name||"New business project";try{const e=await fetch("/api/ai/start-business-plan",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.getAttribute("content"))||"",Accept:"application/json"},body:JSON.stringify({business_idea:s,project_id:l.id,project_name:l.name,project_description:l.description})});if(console.log("API Response Status:",e.status),console.log("API Response Headers:",Object.fromEntries(e.headers)),!e.ok){const o=await e.text();throw console.error("HTTP Error:",e.status,o),e.status===404?new Error(c("api_not_found","API endpoint not found. Please check if the backend is running and routes are properly configured.")):e.status===403?new Error(c("api_unauthorized","Unauthorized access. Please refresh the page and try again.")):e.status===500?new Error(c("server_error","Internal server error. Please try again later.")):new Error(`HTTP error! status: ${e.status}`)}const n=e.headers.get("content-type");if(!n||!n.includes("application/json")){const o=await e.text();throw console.error("Non-JSON response received:",o.substring(0,200)),new Error(c("server_returned_html_error","Server returned an error page instead of JSON"))}const u=await e.json();if(console.log("Start AI conversation result:",u),!u.success)throw new Error(u.message||"Failed to start AI conversation");return u}catch(e){throw console.error("Error in startAIConversation:",e),e.message.includes("Failed to fetch")?new Error(c("network_error","Network error. Please check your internet connection and that the server is running.")):e}},submitAnswer:async(l,s,m,e,n=null)=>{var h;const u=n||x.answer,o={question:l.question,question_type:l.type||"text",answer:u,timestamp:new Date,...l.type==="cost_breakdown"&&{cost_breakdown_details:JSON.parse(u)}},a=[...s,o];try{const t=await fetch("/api/ai/next-question",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((h=document.querySelector('meta[name="csrf-token"]'))==null?void 0:h.getAttribute("content"))||"",Accept:"application/json"},body:JSON.stringify({answer:u,previous_answers:a,business_idea:m.description||m.name||"New business project",question_count:e})});if(!t.ok){const w=await t.text();throw console.error("HTTP Error:",t.status,w),t.status===404?new Error(c("api_not_found","API endpoint not found.")):new Error(`HTTP error! status: ${t.status}`)}const y=t.headers.get("content-type");if(y&&y.includes("application/json")){const w=await t.json();if(console.log("Next question result:",w),!w.success)throw new Error(w.message||"Failed to get next question");return{result:w,newAnswer:o}}else{const w=await t.text();console.error("HTML Error Response:",w.substring(0,200));const v=w.match(/<title>([^<]+)<\/title>/),T=v?v[1]:c("server_error","Server error");throw new Error(`${T} - ${c("server_returned_html_error","Server returned an error page instead of JSON")}`)}}catch(t){throw console.error("Error in submitAnswer:",t),t.message.includes("Failed to fetch")?new Error(c("network_error","Network error. Please check your connection.")):t}},generatePlan:async(l,s)=>{var e;const m=s.description||s.name||"New business project";try{console.log("Generating plan with data:",{answers:l,business_idea:m,project_id:s.id,project_name:s.name,project_description:s.description});const n=await fetch("/api/ai/generate-plan",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"",Accept:"application/json"},body:JSON.stringify({answers:l,business_idea:m,project_id:s.id,project_name:s.name,project_description:s.description})});if(!n.ok){const o=await n.text();throw console.error("Generate plan HTTP Error:",n.status,o),n.status===404?new Error(c("api_not_found","API endpoint not found.")):new Error(`HTTP error! status: ${n.status}`)}const u=n.headers.get("content-type");if(u&&u.includes("application/json")){const o=await n.json();if(console.log("Generate plan result:",o),!o.success)throw new Error(o.message||"Failed to generate business plan");return o}else{const o=await n.text();throw console.error("Non-JSON response:",o.substring(0,200)),new Error(c("server_invalid_response","Server did not return a valid response"))}}catch(n){throw console.error("Error in generatePlan:",n),n.message.includes("Failed to fetch")?new Error(c("network_error","Network error. Please check your connection.")):n}},checkGenerationStatus:async l=>{var o;let s=!0,m=0,e=0;const n=120,u=1e3;for(console.log(`Starting status check for plan ${l}`);s&&m<n;){m++;try{const a=await fetch(`/api/plans/${l}/status`,{headers:{"X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||"",Accept:"application/json"}});if(!a.ok){if(e++,console.error(`Status check failed: ${a.status} ${a.statusText}`),e>=5){console.log("Multiple consecutive errors, will reload page"),window.location.reload(),s=!1;break}await new Promise(t=>setTimeout(t,5e3));continue}e=0;const h=a.headers.get("content-type");if(h&&h.includes("application/json")){const t=await a.json();if(console.log(`Status check attempt ${m}:`,t),t.status==="completed"||t.is_completed)console.log("Plan generation completed, reloading page"),window.location.reload(),s=!1;else if(t.status==="failed"||t.has_failed)console.error("Plan generation failed:",t),alert(c("plan_generation_failed_alert","An error occurred while creating the business plan. Please try again.")),s=!1;else if(t.is_generating||t.status==="generating"){const y=t.progress||t.completion_score||0;console.log(`Generation in progress: ${y}%`),await new Promise(w=>setTimeout(w,u))}else console.log(`Unknown status: ${t.status}, continuing...`),await new Promise(y=>setTimeout(y,u))}else console.error("Non-JSON response from status endpoint"),await new Promise(t=>setTimeout(t,5e3))}catch(a){console.error("Error checking status:",a),e++,e>=5?(console.log("Too many errors, giving up"),alert(c("status_check_failed","Unable to check plan status. Please refresh the page to see if your plan is ready.")),s=!1):await new Promise(h=>setTimeout(h,5e3))}}m>=n&&(console.log("Maximum attempts reached, reloading page"),alert(c("generation_timeout","Plan generation is taking longer than expected. Refreshing the page to check the current status.")),window.location.reload())}}}const V=({className:c})=>r.jsx("svg",{className:c,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})});function je({auth:c,projects:x,project_id:j=null}){const{t:p}=q(),[k,S]=f.useState("intro"),[N,A]=f.useState(null),[l,s]=f.useState([]),[m,e]=f.useState(!1),[n,u]=f.useState(null),[o,a]=f.useState(null),[h,t]=f.useState(0),[y,w]=f.useState(null),{data:v,setData:T,handleCreateNewProject:O,startAIConversation:$,submitAnswer:R,generatePlan:F,checkGenerationStatus:H}=W();f.useEffect(()=>{if(j&&x&&x.length>0){const g=x.find(i=>i.id===parseInt(j,10));g&&u(g)}},[j,x]);const L=async g=>{u(g),e(!0),a(null);try{const i=await $(g);if(i&&i.success&&i.question)A(i.question),t(1),S("questions");else{const d=(i==null?void 0:i.message)||p("ai_conversation_failed","Failed to start AI conversation");throw new Error(d)}}catch(i){let d;i.message.includes("404")?d=p("api_endpoint_not_found","API endpoint not found. Please check your backend configuration."):i.message.includes("fetch")?d=p("network_error","Network error. Please check your internet connection."):d=p("error_starting_conversation","Error starting conversation")+`: ${i.message}`,a(d),u(null)}finally{e(!1)}},M=async()=>{if(!v.answer.trim()){a(p("answer_required","Please provide an answer"));return}e(!0),a(null);try{if(h>=5){await E();return}const{result:g,newAnswer:i}=await R(N,l,n,h),d=[...l,i];if(s(d),g.success)g.question&&h<5?(A(g.question),T("answer",""),t(b=>b+1)):await E(d);else{const b=g.message||p("error_next_question","Error getting next question");throw new Error(b)}}catch(g){const i=p("error_submitting_answer","Error submitting answer")+`: ${g.message}`;a(i)}finally{e(!1)}},E=async(g=null)=>{S("generating"),a(null);try{const d=await F(g||l,n);if(d.success)w(d),setTimeout(()=>{C.visit(`/plans/${d.plan.id}`,{onSuccess:()=>{H(d.plan.id)},onError:b=>{a("Failed to navigate to plan page")}})},3e3);else{const b=d.message||p("error_generating_plan","Error generating business plan");throw new Error(b)}}catch(i){S("error");const d=p("plan_generation_failed","Plan generation failed")+`: ${i.message}`;a(d)}},P=()=>{S("intro"),a(null),u(null),s([]),t(0),A(null),T("answer",""),w(null)};return r.jsxs(D,{user:c.user,children:[r.jsx("div",{className:"mb-10",children:r.jsx(z,{})}),r.jsx(J,{title:p("create_business_plan_ai","Create Business Plan with AI")}),r.jsx(I,{children:o&&r.jsx(_.div,{className:"mx-4",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},children:r.jsx(U,{error:o,onDismiss:()=>a(null)})})}),r.jsx("div",{className:"min-h-screen flex items-center justify-center py-20",children:r.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 w-full",children:r.jsxs(I,{mode:"wait",children:[k==="intro"&&r.jsx(X,{isLoading:m,projectSelection:r.jsx(K,{projects:x,selectedProject:n,onSelectProject:L,onCreateNewProject:O})}),k==="questions"&&N&&r.jsx(B,{currentQuestion:N,questionCount:h,totalQuestions:5,answer:v.answer,onAnswerChange:g=>T("answer",g),onSubmit:M,isLoading:m,onReset:P}),k==="generating"&&r.jsxs(_.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.5},className:"text-center space-y-8",children:[r.jsx(Q,{}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"max-w-md mx-auto",children:r.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:r.jsx(_.div,{className:"bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full",initial:{width:0},animate:{width:"100%"},transition:{duration:2,repeat:1/0}})})}),y&&r.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[r.jsx("p",{className:"text-green-800 dark:text-green-200 font-medium",children:p("plan_created_successfully","Plan created successfully!")}),r.jsx("p",{className:"text-green-600 dark:text-green-300 text-sm mt-1",children:p("redirecting_to_plan","Redirecting to your plan...")})]})]})]},"generating"),k==="error"&&r.jsxs(_.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.5},className:"text-center space-y-8",children:[r.jsx(_.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"w-24 h-24 mx-auto bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:r.jsx(V,{className:"w-12 h-12 text-red-500"})}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("h2",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:p("business_plan_generation_error","An error occurred during business plan generation")}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md mx-auto",children:p("error_try_again","Don't worry, let's try again with a fresh start.")})]}),r.jsx(_.button,{onClick:P,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-8 py-3 rounded-lg font-semibold transition-all duration-200",whileHover:{scale:1.05},whileTap:{scale:.95},children:p("try_again","Try Again")})]},"error")]})})})]})}export{je as default};
