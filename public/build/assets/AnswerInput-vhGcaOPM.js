import{r as h,j as t}from"./app-BFNWlO_M.js";import{u as R}from"./useTranslation-CsAikbEO.js";function C({question:r,answer:d,onChange:f,onKeyPress:g,disabled:m=!1,autoFocus:p=!0,placeholder:w,businessIdea:v="",projectName:y="",projectDescription:j="",previousAnswers:k=[]}){const{t:a}=R(),_=h.useRef(null),i=h.useRef(null),[b,N]=h.useState(!1),n=(r==null?void 0:r.type)==="number",l=(r==null?void 0:r.type)==="cost_breakdown",x=e=>{if(!e)return;e.style.height="auto";const s=144,c=400,o=e.scrollHeight;if(o<=c){const u=Math.max(s,o);e.style.height=u+"px",e.style.overflowY="hidden"}else e.style.height=c+"px",e.style.overflowY="auto",e.style.scrollBehavior="smooth"};h.useEffect(()=>{const e=i.current;if(!e||n||l)return;const s=c=>{if(e.scrollHeight>e.clientHeight){c.stopPropagation();const o=c.deltaY;e.scrollTop+=o}};return e.addEventListener("wheel",s,{passive:!1}),()=>{e.removeEventListener("wheel",s)}},[n,l]),h.useEffect(()=>{if(p&&!m&&!l){const e=n?_.current:i.current;e&&(e.focus(),!n&&i.current&&x(i.current))}},[r==null?void 0:r.question,p,m,n,l]),h.useEffect(()=>{!n&&!l&&i.current&&x(i.current)},[d,n,l]);const T=e=>{f(e.target.value),x(e.target)},E=e=>{g&&g(e),e.key==="Enter"&&e.ctrlKey&&!n&&!l&&(e.preventDefault(),g&&g(e))},A=async()=>{var e;if(!b){N(!0);try{console.log("Making request to:","/plans/ai/generate-answer"),console.log("Request data:",{question:(r==null?void 0:r.question)||"",question_type:(r==null?void 0:r.type)||"text",business_idea:v,project_name:y,project_description:j,previous_answers:k});const s=await fetch("/plans/ai/generate-answer",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||""},body:JSON.stringify({question:(r==null?void 0:r.question)||"",question_type:(r==null?void 0:r.type)||"text",business_idea:v,project_name:y,project_description:j,previous_answers:k})});if(console.log("Response status:",s.status),console.log("Response headers:",Object.fromEntries(s.headers)),!s.ok){const u=await s.text();throw console.error("HTTP Error:",s.status,u.substring(0,200)),new Error(`HTTP error! status: ${s.status}`)}const c=s.headers.get("content-type");if(!c||!c.includes("application/json")){const u=await s.text();throw console.error("Non-JSON response received:",u.substring(0,500)),new Error("Server returned HTML instead of JSON - likely a 404 or server error")}const o=await s.json();console.log("AI response result:",o),o.success&&o.suggested_answer?(f(o.suggested_answer),setTimeout(()=>{i.current&&x(i.current)},100)):(console.error("AI Answer Error:",o.message),alert("Error: "+(o.message||"Failed to generate answer")))}catch(s){console.error("AI Answer Error:",s),alert("Error generating AI answer: "+s.message)}finally{N(!1)}}};if(l)return t.jsxs("div",{className:"space-y-4",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-200",children:a("cost_breakdown_answer","Cost breakdown complete")}),t.jsx("div",{className:"bg-teal-50 dark:bg-teal-900/30 border border-teal-200 dark:border-teal-800 rounded-xl p-4 shadow-sm",children:t.jsxs("div",{className:"flex items-center gap-2 text-teal-700 dark:text-teal-300",children:[t.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),t.jsx("span",{className:"font-medium",children:a("cost_breakdown_ready","Please fill in the cost estimates above, then click 'Next Question' to continue.")})]})}),t.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:a("cost_breakdown_instructions","Fill in the cost estimates for each item. You can add custom items if needed. The total will be calculated automatically.")})]});const H=()=>n?t.jsx("input",{ref:_,type:"number",value:d,onChange:e=>f(e.target.value),onKeyDown:E,placeholder:w||a("enter_number_placeholder","Enter number here..."),className:"w-full h-12 p-4 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-slate-800 dark:text-white transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm hover:border-indigo-300 dark:hover:border-indigo-700",autoFocus:p,disabled:m,min:"0",step:"any"}):t.jsxs("div",{className:"textarea-container relative",children:[t.jsx("textarea",{ref:i,value:d,onChange:T,onKeyDown:E,placeholder:w||a("enter_answer_placeholder","Share your thoughts..."),className:"enhanced-auto-textarea",autoFocus:p,disabled:m,style:{minHeight:"144px",maxHeight:"400px",height:"auto",resize:"none",overflow:"hidden"}}),t.jsxs("div",{className:"character-counter",children:[d.length," ",a("characters","characters")]})]});return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-200",children:!l&&t.jsxs(t.Fragment,{children:[a("your_answer","Your answer:"),(r==null?void 0:r.type)==="number"&&t.jsxs("span",{className:"text-indigo-600 dark:text-indigo-400 ml-1",children:["(",a("numeric_value","numeric value"),")"]})]})}),!l&&!n&&t.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${d.length<10?"text-red-700 bg-red-50 dark:bg-red-900/20 dark:text-red-400":"text-indigo-700 bg-indigo-50 dark:bg-indigo-900/20 dark:text-indigo-400"}`,children:d.length<10?a("answer_too_short","Try to provide more detail"):a("good_length","Good length")})]}),!l&&!n&&t.jsx("button",{type:"button",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-400 disabled:to-gray-400 text-white text-xs px-3 py-1.5 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 disabled:cursor-not-allowed disabled:transform-none",onClick:A,disabled:b||m,children:b?t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}),a("generating","Generating...")]}):a("let_ai_answer","Let AI Answer it for me")})]}),H(),!l&&t.jsx("div",{className:"flex justify-between items-center text-xs text-slate-500 dark:text-slate-400 px-1",children:t.jsx("span",{className:"flex items-center gap-1",children:n&&a("enter_valid_number","Enter a valid number")})})]})}export{C as default};
