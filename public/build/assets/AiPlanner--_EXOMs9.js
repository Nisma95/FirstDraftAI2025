import{m as J,S as I,r as f,j as e,L as z}from"./app-DE_R_iJl.js";import{A as B}from"./AuthenticatedLayout-CLOBMT_z.js";import{T as D}from"./TopTools-xlDbW0KN.js";import{F as K}from"./SparklesIcon-DoGcjtNO.js";import Q from"./ProjectSelection-Wm9Whn-Z.js";import X from"./QuestionsStep-BR6ZEuV7.js";import U from"./GeneratingStep-C5Q94D_N.js";import{u as O}from"./useTranslation-DZNTQt5Z.js";import{A as q}from"./index-5kRfX2RQ.js";import{m as w}from"./proxy-D8RcZd1H.js";import"./StarBackground-BJZFSX9x.js";import"./ApplicationLogo-BcOSr4Kz.js";import"./LanguageSwitcher-qMr_Sr7W.js";import"./createLucideIcon-BI_kgnih.js";import"./ProjectSelectionCard-C-ti2Bny.js";import"./CreateNewProjectCard-B0thR91i.js";import"./PlusIcon-u_rSp_ZN.js";import"./ProgressBar-CBU0N5oh.js";import"./AIQuestionCard-CeJIzKPJ.js";import"./CurrencyDollarIcon-BYF2eA3N.js";import"./AnswerInput-3z52aHdw.js";function W(){const{t:d}=O(),{data:y,setData:b}=J({answer:""});return{data:y,setData:b,handleCreateNewProject:()=>{I.visit("/projects/create")},startAIConversation:async u=>{var g;const i=u.description||u.name||"New business project";try{const t=await fetch("/api/ai/start-business-plan",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((g=document.querySelector('meta[name="csrf-token"]'))==null?void 0:g.getAttribute("content"))||"",Accept:"application/json"},body:JSON.stringify({business_idea:i,project_id:u.id,project_name:u.name,project_description:u.description})});if(console.log("API Response Status:",t.status),console.log("API Response Headers:",Object.fromEntries(t.headers)),!t.ok){const l=await t.text();throw console.error("HTTP Error:",t.status,l),t.status===404?new Error(d("api_not_found","API endpoint not found. Please check if the backend is running and routes are properly configured.")):t.status===403?new Error(d("api_unauthorized","Unauthorized access. Please refresh the page and try again.")):t.status===500?new Error(d("server_error","Internal server error. Please try again later.")):new Error(`HTTP error! status: ${t.status}`)}const s=t.headers.get("content-type");if(!s||!s.includes("application/json")){const l=await t.text();throw console.error("Non-JSON response received:",l.substring(0,200)),new Error(d("server_returned_html_error","Server returned an error page instead of JSON"))}const p=await t.json();if(console.log("Start AI conversation result:",p),!p.success)throw new Error(p.message||"Failed to start AI conversation");return p}catch(t){throw console.error("Error in startAIConversation:",t),t.message.includes("Failed to fetch")?new Error(d("network_error","Network error. Please check your internet connection and that the server is running.")):t}},submitAnswer:async(u,i,g,t,s=null)=>{var h;const p=s||y.answer,l={question:u.question,question_type:u.type||"text",answer:p,timestamp:new Date,...u.type==="cost_breakdown"&&{cost_breakdown_details:JSON.parse(p)}},c=[...i,l];try{const r=await fetch("/api/ai/next-question",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((h=document.querySelector('meta[name="csrf-token"]'))==null?void 0:h.getAttribute("content"))||"",Accept:"application/json"},body:JSON.stringify({answer:p,previous_answers:c,business_idea:g.description||g.name||"New business project",question_count:t})});if(!r.ok){const x=await r.text();throw console.error("HTTP Error:",r.status,x),r.status===404?new Error(d("api_not_found","API endpoint not found.")):new Error(`HTTP error! status: ${r.status}`)}const _=r.headers.get("content-type");if(_&&_.includes("application/json")){const x=await r.json();if(console.log("Next question result:",x),!x.success)throw new Error(x.message||"Failed to get next question");return{result:x,newAnswer:l}}else{const x=await r.text();console.error("HTML Error Response:",x.substring(0,200));const j=x.match(/<title>([^<]+)<\/title>/),S=j?j[1]:d("server_error","Server error");throw new Error(`${S} - ${d("server_returned_html_error","Server returned an error page instead of JSON")}`)}}catch(r){throw console.error("Error in submitAnswer:",r),r.message.includes("Failed to fetch")?new Error(d("network_error","Network error. Please check your connection.")):r}},generatePlan:async(u,i)=>{var t;const g=i.description||i.name||"New business project";try{console.log("Generating plan with data:",{answers:u,business_idea:g,project_id:i.id,project_name:i.name,project_description:i.description});const s=await fetch("/api/ai/generate-plan",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||"",Accept:"application/json"},body:JSON.stringify({answers:u,business_idea:g,project_id:i.id,project_name:i.name,project_description:i.description})});if(!s.ok){const l=await s.text();throw console.error("Generate plan HTTP Error:",s.status,l),s.status===404?new Error(d("api_not_found","API endpoint not found.")):new Error(`HTTP error! status: ${s.status}`)}const p=s.headers.get("content-type");if(p&&p.includes("application/json")){const l=await s.json();if(console.log("Generate plan result:",l),!l.success)throw new Error(l.message||"Failed to generate business plan");return l}else{const l=await s.text();throw console.error("Non-JSON response:",l.substring(0,200)),new Error(d("server_invalid_response","Server did not return a valid response"))}}catch(s){throw console.error("Error in generatePlan:",s),s.message.includes("Failed to fetch")?new Error(d("network_error","Network error. Please check your connection.")):s}},checkGenerationStatus:async u=>{var l;let i=!0,g=0,t=0;const s=120,p=1e3;for(console.log(`Starting status check for plan ${u}`);i&&g<s;){g++;try{const c=await fetch(`/api/plans/${u}/status`,{headers:{"X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||"",Accept:"application/json"}});if(!c.ok){if(t++,console.error(`Status check failed: ${c.status} ${c.statusText}`),t>=5){console.log("Multiple consecutive errors, will reload page"),window.location.reload(),i=!1;break}await new Promise(r=>setTimeout(r,5e3));continue}t=0;const h=c.headers.get("content-type");if(h&&h.includes("application/json")){const r=await c.json();if(console.log(`Status check attempt ${g}:`,r),r.status==="completed"||r.is_completed)console.log("Plan generation completed, reloading page"),window.location.reload(),i=!1;else if(r.status==="failed"||r.has_failed)console.error("Plan generation failed:",r),alert(d("plan_generation_failed_alert","An error occurred while creating the business plan. Please try again.")),i=!1;else if(r.is_generating||r.status==="generating"){const _=r.progress||r.completion_score||0;console.log(`Generation in progress: ${_}%`),await new Promise(x=>setTimeout(x,p))}else console.log(`Unknown status: ${r.status}, continuing...`),await new Promise(_=>setTimeout(_,p))}else console.error("Non-JSON response from status endpoint"),await new Promise(r=>setTimeout(r,5e3))}catch(c){console.error("Error checking status:",c),t++,t>=5?(console.log("Too many errors, giving up"),alert(d("status_check_failed","Unable to check plan status. Please refresh the page to see if your plan is ready.")),i=!1):await new Promise(h=>setTimeout(h,5e3))}}g>=s&&(console.log("Maximum attempts reached, reloading page"),alert(d("generation_timeout","Plan generation is taking longer than expected. Refreshing the page to check the current status.")),window.location.reload())}}}const C=({className:d})=>e.jsx("svg",{className:d,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})});function fe({auth:d,projects:y,project_id:b=null}){const{t:n}=O(),[k,N]=f.useState("intro"),[A,T]=f.useState(null),[u,i]=f.useState([]),[g,t]=f.useState(!1),[s,p]=f.useState(null),[l,c]=f.useState(null),[h,r]=f.useState(0),[_,x]=f.useState(null),{data:j,setData:S,handleCreateNewProject:R,startAIConversation:$,submitAnswer:L,generatePlan:F,checkGenerationStatus:M}=W();f.useEffect(()=>{if(b&&y&&y.length>0){const a=y.find(o=>o.id===parseInt(b,10));a&&(console.log("Auto-selecting project:",a),p(a))}},[b,y]);const G=async a=>{console.log("üöÄ Selecting project:",a),p(a),t(!0),c(null);try{console.log("üöÄ Starting AI conversation for project:",a);const o=await $(a);if(console.log("‚úÖ AI conversation result:",o),o&&o.success&&o.question)T(o.question),r(1),N("questions"),console.log("‚úÖ Successfully moved to questions step");else{const m=(o==null?void 0:o.message)||n("ai_conversation_failed","Failed to start AI conversation");throw new Error(m)}}catch(o){console.error("‚ùå Error starting AI conversation:",o);let m;o.message.includes("404")?m=n("api_endpoint_not_found","API endpoint not found. Please check your backend configuration."):o.message.includes("fetch")?m=n("network_error","Network error. Please check your internet connection."):m=n("error_starting_conversation","Error starting conversation")+`: ${o.message}`,c(m),p(null)}finally{t(!1)}},H=async()=>{if(!j.answer.trim()){c(n("answer_required","Please provide an answer"));return}t(!0),c(null);try{if(console.log("üìù Submitting answer:",j.answer),console.log("üìä Current question count:",h),h>=5){console.log("üèÅ Reached 5 questions, generating plan..."),await E();return}const{result:a,newAnswer:o}=await L(A,u,s,h);console.log("‚úÖ Answer submitted, result:",a);const m=[...u,o];if(i(m),a.success)a.question&&h<5?(T(a.question),S("answer",""),r(v=>v+1),console.log("‚û°Ô∏è Moving to next question:",a.question.question)):(console.log("üèÅ No more questions, generating plan..."),await E(m));else{const v=a.message||n("error_next_question","Error getting next question");throw new Error(v)}}catch(a){console.error("‚ùå Error submitting answer:",a);const o=n("error_submitting_answer","Error submitting answer")+`: ${a.message}`;c(o)}finally{t(!1)}},E=async(a=null)=>{console.log("üî® Starting plan generation..."),N("generating"),c(null);try{const o=a||u;console.log("üìä Generating plan with answers:",o),console.log("üìä Selected project:",s);const m=await F(o,s);if(console.log("‚úÖ Plan generation result:",m),m.success)x(m),console.log("üéâ Plan created successfully, redirecting..."),setTimeout(()=>{I.visit(`/plans/${m.plan.id}`,{onSuccess:()=>{console.log("üìç Successfully navigated to plan page"),M(m.plan.id)},onError:v=>{console.error("‚ùå Navigation error:",v),c("Failed to navigate to plan page")}})},3e3);else{const v=m.message||n("error_generating_plan","Error generating business plan");throw new Error(v)}}catch(o){console.error("‚ùå Error generating plan:",o),N("error");const m=n("plan_generation_failed","Plan generation failed")+`: ${o.message}`;c(m)}},P=()=>{N("intro"),c(null),p(null),i([]),r(0),T(null),S("answer",""),x(null)};return e.jsxs(B,{user:d.user,children:[e.jsx("div",{className:"mb-10",children:e.jsx(D,{})}),e.jsx(z,{title:n("create_business_plan_ai","Create Business Plan with AI")}),e.jsx(q,{children:l&&e.jsx(w.div,{className:"mx-4",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6 mb-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(C,{className:"w-6 h-6 text-red-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:n("error_occurred","An error occurred")}),e.jsx("p",{className:"mt-1 text-sm text-red-700 dark:text-red-300",children:l})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:()=>c(null),className:"inline-flex text-red-400 hover:text-red-600 dark:hover:text-red-200",children:[e.jsx("span",{className:"sr-only",children:n("dismiss","Dismiss")}),e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})]})})})}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs(q,{mode:"wait",children:[k==="intro"&&e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5},className:"text-center space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(w.div,{className:"w-24 h-24 mx-auto bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:200},children:e.jsx(K,{className:"w-12 h-12 text-white"})}),e.jsx(w.h1,{className:"text-4xl font-bold text-gray-900 dark:text-white",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:n("ai_plan_intro_title","Let's Create Your Business Plan Together! üöÄ")}),e.jsxs(w.p,{className:"text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[n("ai_plan_intro_description","I'll ask you 5 smart questions about your business plan and create a comprehensive analysis based on your answers.")," ",n("select_project_to_begin","Simply select a project to begin!")]})]}),g&&e.jsxs(w.div,{className:"flex items-center justify-center gap-2 text-purple-600",initial:{opacity:0},animate:{opacity:1},children:[e.jsx("div",{className:"w-5 h-5 border-2 border-purple-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:n("starting_ai_conversation","Starting AI Conversation...")})]}),!g&&e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsx(Q,{projects:y,selectedProject:s,onSelectProject:G,onCreateNewProject:R})})]},"intro"),k==="questions"&&A&&e.jsxs(w.div,{initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},transition:{duration:.5},className:"space-y-6",children:[e.jsx(X,{currentQuestion:A,questionCount:h,totalQuestions:5,answer:j.answer,onAnswerChange:a=>S("answer",a),onSubmit:H,isLoading:g}),e.jsxs("div",{className:"flex justify-between items-center pt-6",children:[e.jsxs("button",{onClick:P,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors",children:["‚Üê ",n("start_over","Start Over")]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("question_progress","Question {{current}} of {{total}}",{current:h,total:5})})]})]},"questions"),k==="generating"&&e.jsxs(w.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.5},className:"text-center space-y-8",children:[e.jsx(U,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:n("analyzing_answers","Analyzing your answers and creating your business plan...")}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx(w.div,{className:"bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full",initial:{width:0},animate:{width:"100%"},transition:{duration:2,repeat:1/0}})})}),_&&e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-green-800 dark:text-green-200 font-medium",children:n("plan_created_successfully","Plan created successfully!")}),e.jsx("p",{className:"text-green-600 dark:text-green-300 text-sm mt-1",children:n("redirecting_to_plan","Redirecting to your plan...")})]})]})]},"generating"),k==="error"&&e.jsxs(w.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.5},className:"text-center space-y-8",children:[e.jsx(w.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"w-24 h-24 mx-auto bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(C,{className:"w-12 h-12 text-red-500"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:n("business_plan_generation_error","An error occurred during business plan generation")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md mx-auto",children:n("error_try_again","Don't worry, let's try again with a fresh start.")})]}),e.jsx(w.button,{onClick:P,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-8 py-3 rounded-lg font-semibold transition-all duration-200",whileHover:{scale:1.05},whileTap:{scale:.95},children:n("try_again","Try Again")})]},"error")]})})})]})}export{fe as default};
